# 前端的出错处理

## 前端的错误种类

前端的错误种类千奇百怪，很容易发生开发机器上运行的很完美，但用户机器上却各种错误。  
尤其可怕的是不知道在用户机器上发生了错误，或者缺乏复现的线索。  
人对错误可能发生的种类总是估计不足的，所以必须在可能出错的地方做好错误处理和上报。  

## 错误处理的记录手段

- sentry SaaS服务
- 自行搭建sentry服务 [sentry的docker方式部署](https://docs.sentry.io/server/installation/docker/)
- 阿里前端监控 [前端监控概述](https://help.aliyun.com/document_detail/58652.html)

SaaS服务要收费，并不总是能说服领导多出一笔费用。  
自行搭建服务，前端不一定有服务器资源，服务的稳定性也存在隐患。  
阿里的前端监控还算好用，但是比较费钱，采用阿里的SaaS服务对于领导好理解一些，因为已经为阿里云服务器付费了。  

## 中小应用的错误处理

基于以上的原因，我在某款Web应用中采用了如下的错误处理手段。  
1. 自己服务器的日志接口。记录比较敏感的前端错误，比如包含用户信息的一些接口请求失败，可以记录接口地址和请求数据。
2. 百度统计的事件分析。对于不是那么紧急的前端报错或可能遗漏的错误，通过事件上报来记录。供后续分析处理。

## 例子

### 在应用中需要用户启用摄像头，但摄像头可能有各种原因会启动失败

记录摄像头启动失败的原因，并且在百度统计中可以看到失败的次数，针对失败的原因来调整启用摄像头的方式。
统计到摄像头开启成功一段时间后，再次使用摄像头的相关信息却会失败，因为统计到有这种现象，所以增加了额外的错误处理。
而这些信息在本地往往是无法复现的。

### 网络请求超时统计或500错误

因为各种原因，网络请求可能会超时，统计到各个接口请求超时的比例后，我们就有了优化客户端网络请求和优化服务器端接口性能的依据。

